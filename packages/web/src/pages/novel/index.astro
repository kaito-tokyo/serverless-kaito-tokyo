---
import fetchApi from "../../lib/strapi.js";
import type { Novel } from "../../interfaces/Novel.js";

const novels = await fetchApi<Novel[]>({
  endpoint: "novels?sort=Date:desc",
  wrappedByKey: "data",
});

const groupedNovels: { [key: string]: Novel[] } = {};
novels.forEach((novel) => {
  const date = new Date(novel.Date);
  const month = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
  if (!groupedNovels[month]) {
    groupedNovels[month] = [];
  }
  groupedNovels[month].push(novel);
});
---

<!doctype html>
<html lang="ja-JP">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>小説 - kaito.tokyo</title>
  </head>
  <body>
    <main>
      <h1>小説</h1>
      {Object.entries(groupedNovels).map(([month, novelsInMonth]) => (
        <section>
          <h2>{new Date(month).toLocaleString('ja-JP', { year: 'numeric', month: 'long' })}</h2>
          <ul>
            {novelsInMonth.map((novel) => (
              <li>
                <a href={`/novel/${novel.slug}`}>
                  <h2>{novel.Title}</h2>
                </a>
              </li>
            ))}
          </ul>
        </section>
      ))}
    </main>
  </body>
</html>
