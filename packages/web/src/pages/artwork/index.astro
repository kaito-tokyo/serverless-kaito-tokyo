---
import "../../styles/global.css";
import fetchApi from "../../lib/strapi.js";
import type { Artwork } from "../../interfaces/Artwork.js";

const artworks = await fetchApi<Artwork[]>({
  endpoint: "artworks?populate=*&sort=Date:desc",
  wrappedByKey: "data",
});

const groupedArtworks: { [key: string]: Artwork[] } = {};
artworks.forEach((artwork) => {
  const date = new Date(artwork.Date);
  const month = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
  if (!groupedArtworks[month]) {
    groupedArtworks[month] = [];
  }
  groupedArtworks[month].push(artwork);
});
---

<!doctype html>
<html lang="ja-JP">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>イラスト - kaito.tokyo</title>
  </head>
  <body>
    <main>
      <h1>イラスト - Kaito.tokyo</h1>
      {Object.entries(groupedArtworks).map(([month, artworksInMonth]) => (
        <section>
          <h2>{new Date(month).toLocaleString('ja-JP', { year: 'numeric', month: 'long' })}</h2>
          <ul>
            {artworksInMonth.map((artwork) => {
              if (!artwork.SdrImage || !artwork.SdrImage.url || !artwork.SdrImage.width || !artwork.SdrImage.height) {
                return null; // Skip artworks without an image
              }
              return (
                <a href={`/artwork/${artwork.slug}`}>
                  <li>
                    <img
                      src={artwork.SdrImage.url}
                      alt={artwork.Title}
                      loading="eager"
                      decoding="sync"
                      width="200"
                      height={
                        artwork.SdrImage.width > 0 && artwork.SdrImage.height > 0
                          ? (200 / artwork.SdrImage.width) * artwork.SdrImage.height
                          : undefined
                      }
                    />
                    <p>{artwork.Date}</p>
                    <p>{artwork.Title}</p>
                  </li>
                </a>
              );
            })}
          </ul>
        </section>
      ))}
    </main>
  </body>
</html>

<style>
  ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  li {
    width: 200px;
    margin: 0;
    padding: 0;
    background: hsla(0, 0%, 98%, 0.9);
    border-radius: 20px;
    padding: 15px 0;
    border: 2px solid black;
  }
</style>
